<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <script src="./lib/sentimentChart.js"></script>

  <div class="position_sizing_inputs">
    <label for="ticker">Ticker</label>
    <input type="text" id="ticker">
    <label for="granularity">Granularity</label>
    <input type="text" id="granularity">
    <label for="balance-input">Balance</label>
    <input type="number" id="balance-input">
    <input type="button" id="submit" name="submit" value="Submit">
  </div>

  <div class="position_sizing_results">
    Target ticker: <span id="target-ticker"></span><br>
    Balance: <span id="balance"></span><br>
    Baserate ticker: <span id="baserate-ticker"></span><br>
    CurrentATR(14): <span id="atr14"></span><br>
    Recommend Position Size: <span id="ps"></span><br>
  </div>

  <script>
    document.getElementById("submit").addEventListener("click", process)

    function process(){
      var url = new URL("http://localhost:5000/position_size")
      var ticker = document.getElementById("ticker").value
      var granularity = document.getElementById("granularity").value
      var manualBalance = document.getElementById("balance-input").value
      url.searchParams.append("ticker", ticker)
      url.searchParams.append("granularity", granularity)
      url.searchParams.append("manual_balance", manualBalance)

      var xhttp = new XMLHttpRequest()

      xhttp.onreadystatechange = function() {
        if(this.readyState == 4 && this.status == 200) {
          var resultObj = JSON.parse(this.responseText)
          document.getElementById("ps").innerHTML = resultObj.position_size.toFixed(1)
          document.getElementById("balance").innerHTML = resultObj.balance.toFixed(2)
          document.getElementById("atr14").innerHTML = resultObj.atr.toFixed(5)
          document.getElementById("baserate-ticker").innerHTML = resultObj.baserate_ticker
          document.getElementById("target-ticker").innerHTML = resultObj.target_ticker

        }
      }

      xhttp.open("GET", url, true)
      xhttp.send()

    }

  </script>



<!-- r["balance"] = self.balance
r["account_number"] = self.ctx.active_account
r["base_rate"] = self.latest_baserate
r["base_rate_time"] = self.latest_baserate_time
r["atr"] = self.current_atr
r["position_size"] = self.position_size -->


</body>
</html>
